<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html,
    body {
      margin: 0;
      width: 100%;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    #actions {
      background-color: rgb(var(--base-1));
      border-bottom: 1px solid rgb(var(--neutral-1));
      padding: 10px;
      display: flex;
      gap: 10px;
    }

    gui-chart {
      display: block;
      width: 100%;
      height: 100vh;
    }
  </style>
  <title>@greycat/ui - gui-chart</title>
</head>

<body>
  <div id="actions">
    <button class="inverted" id="randomize">Randomize</button>
  </div>
  <gui-chart></gui-chart>

  <script type="module">
    import '../src/bundle.ts';

    const max = 100;
    const lineData = Array.from({ length: max }, (_, i) => ({ x: i, y: 0 }));
    const areaData = Array.from({ length: max }, (_, i) => ({ x: i, y: 0 }));
    const scatterData = Array.from({ length: max }, (_, i) => ({ x: i, y: 0 }));
    const barData = [
      { x: 0, y: 0 },
      { x: 1, y: 0 },
      { x: 2, y: 0 },
      { x: 3, y: 0 },
      { x: 4, y: 0 },
      { x: max - 5, y: 0 },
      { x: max - 4, y: 0 },
      { x: max - 3, y: 0 },
      { x: max - 2, y: 0 },
      { x: max - 1, y: 0 },
    ];
    const chart = document.querySelector('gui-chart');

    randomize();

    chart.config = {
      margin: {
        top: 20,
        right: 35,
        bottom: 25,
        left: 35,
      },
      domain: {
        xMin: -1,
        xMax: max,
        yMin: 1,
        yMax: 200,
      },
      series: [
        {
          type: 'line+scatter',
          data: lineData,
        },
        {
          type: 'scatter',
          data: scatterData,
          yScale: 'log',
        },
        {
          type: 'line+area',
          data: areaData,
          kind: 'below',
          // color: 'orange',
        },
        {
          type: 'bar',
          data: barData,
        },
      ],
    };

    function randomize() {
      let prev1 = 100;
      let prev2 = 80;
      for (let i = 0; i < max; i++) {
        prev1 += 5 - Math.random() * 10;
        prev1 = Math.max(0, prev1);
        lineData[i].y = prev1;
        areaData[i].y = randomInt(prev1 - 10, prev1 + 10);
        if (i === 20) {
          lineData[i].dashed = true;
        }
        if (i === 45) {
          lineData[i].dashed = false;
        }
        prev2 += 5 - Math.random() * 10;
        prev2 = Math.max(0, prev2);
        scatterData[i].y = prev2;

        if (i >= 0 && i < 5) {
          barData[i].y = randomInt(1, 40);
        }

        if (i >= (max - 5) && i < max) {
          barData[(i % 5) + 5].y = randomInt(1, 40);
        }
      }

      /**
       * The maximum is exclusive and the minimum is inclusive
       */
      function randomInt(min, max) {
        min = Math.ceil(min);
        max = Math.floor(max);
        return Math.floor(Math.random() * (max - min) + min);
      }
    }

    document.querySelector('#randomize').onclick = () => {
      randomize();
      // order is important here, make sure it matches 'chart.config.series'
      chart.config.series[0].data = lineData;
      chart.config.series[1].data = scatterData;
      chart.config.series[2].data = areaData;
      chart.config.series[3].data = barData;
      chart.update();
    };
  </script>
</body>

</html>